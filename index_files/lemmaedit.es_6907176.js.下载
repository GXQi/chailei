define("wiki-m-lemma:widget/lemmaedit/lemmaedit.es",["require","exports","module","wiki-m-common:widget/lib/zepto/zepto","wiki-m-common:widget/util/nslog","wiki-m-lemma:widget/tools/help/help","wiki-m-lemma:widget/tools/dialog/dialog","wiki-m-lemma:widget/tools/clickoutside/clickoutside.es","wiki-m-common:widget/component/swan/swanUtil"],function(e,t){"use strict";function a(e,t){function a(){h?e&&e():t&&t()}v?a():u.wikisubmitViewcheck(w,function(e){v=!0,e.errno||(h=e.data.edit,a())})}function i(e){var t=u.storage.get("BASEINFO"),a="/edit/"+encodeURIComponent(t.lemmaTitle)+"/"+t.lemmaId;return e&&(a=a+"?dl="+e),f.inSmartprogram?void f.navigateTo("/pages/blue/blue",page.baseUrl+a):void u.checkHasNeedGuaranteeForPersonal(t.lemmaId,function(a){if(0===parseInt(a.errno,10)&&a.guarantee&&0===parseInt(a.guarantee.isAgreed,10)){var i=new g("本人词条编辑服务提示","抱歉，您需要签署承诺函才能正常使用本人词条编辑服务，请前往电脑端进行编辑，依据提示进行承诺函的签署。",[{text:"我知道了",callback:function(e){e.close()}}]);i.show()}else!function(){var a="/edit/"+encodeURIComponent(t.lemmaTitle)+"/"+t.lemmaId;e&&(a=a+"?dl="+e),u.preeditCheckHelp({lemmaId:t.lemmaId,lemmaTitle:t.lemmaTitle,lemmaDesc:t.lemmaDesc,versionId:t.versionId},function(e){if(e.errno)switch(e.errno){case 110003:r.qAll("20005711");break;case 110005:r.qAll("20005712");break;case 110008:r.qAll("20005713");break;case 100001:r.qAll("20005718")}else window.location.href=page.baseUrl+a})}()})}function l(){var e=u.storage.get("BASEINFO"),t="/wikisubmit/abstractimgload?lemmaId="+e.lemmaId+"&lemmaTitle="+encodeURIComponent(e.lemmaTitle);return f.inSmartprogram?void f.navigateTo("/pages/dark/dark",page.baseUrl+t):void u.preeditCheckHelp({lemmaId:e.lemmaId,lemmaTitle:e.lemmaTitle,lemmaDesc:e.lemmaDesc,versionId:e.versionId},function(e){if(e.errno)switch(e.errno){case 110003:r.qAll("20005714");break;case 110005:r.qAll("20005715");break;case 110008:r.qAll("20005716");break;case 100001:r.qAll("20005719")}else window.location.href=page.baseUrl+t})}function o(){var e=new g("对不起，该目录下内容暂不支持手机端编辑","百科手机端目前仅支持基础文字编辑，暂不支持图文、表格等模块内容编辑。完整编辑功能正在开发中，敬请期待！",[{text:"我知道了",callback:function(e){e.close()}}]);e.show()}function n(){var e=new g("词条已锁定，暂时无法编辑","亲爱的用户，词条存在争议或内容较完善都可能被锁定（<a href=https://baike.baidu.com/item/%E7%99%BE%E5%BA%A6%E7%99%BE%E7%A7%91%EF%BC%9A%E9%94%81%E5%AE%9A%E8%AF%8D%E6%9D%A1?timestamp=1543991667862>查看详情</a>）。<br/>如果你认为锁定词条内容存在问题需要修改，你可以申请解锁。",[{text:"申请解锁",callback:function(e){r.qAll("20005710"),e.close(),f.inSmartprogram?f.navigateTo("https://tieba.baidu.com/p/5837268093?pn=0"):window.location.href="https://tieba.baidu.com/p/5837268093?pn=0"}},{cls:"btn",text:"返回词条",callback:function(e){e.close()}}]);e.show()}function c(){d("#baike_app_identifier").length>0||a(function(){for(var e=d(".J-lemma-edit"),t=u.storage.get("CATALOG"),a=0;a<e.length;a++)for(var i=e[a],l=d(i),o=l.data(),n=0;n<t.length;n++){var c=t[n];o.title===c.title&&(c.hasText?(l.html('<em class="layout-icons layout-icons_new-pen"></em>'),l.hasClass("J-active")||(l.addClass("J-active"),l.attr("data-dl",c.index))):l.html('<em class="layout-icons layout-icons_pen-forbidden"></em>'))}})}function m(e,t){var a=e.offset(),i=Math.ceil(a.top-d(window).scrollTop());t.css("bottom",null),t.css("top",i+Math.ceil(a.height)+2),t.css("left",a.left-100)}function s(){function e(){s.toggle(),"none"!==s.css("display")?d("body").css("overflow","hidden"):d("body").css("overflow","")}d(".BK-body-wrapper").on("click",".J-lemma-edit",function(){var e=d(this);if(e.hasClass("J-active")){r.qAll("20005717");var t=e.attr("data-dl")||"";i(t)}else o()}),d(".catalog-item").on("tap",".J-catalog-lemma-edit",function(){var e=d(this);if(e.hasClass("J-active")){r.qAll("20005708");var t=e.attr("data-dl")||"";i(t)}else r.qAll("20005709"),o()});var t=d("#J-editentrance"),s=d("#J-editpopup");t.click(function(){var t=this;a(function(){r.qAll("20005702"),m(d(t),s),e()},function(){r.qAll("20005703"),n()})}),p([s[0],t[0]],function(){"none"!==s.css("display")&&e()}),d("#J-editLemma").click(function(){r.qAll("20005705"),i(),e()}),d("#J-editAbstractImg").tap(function(){r.qAll("20005704"),l(),e()});var u=d(".BK-main-content");u.on("mainContentLoaded",function(){c()})}var d=e("wiki-m-common:widget/lib/zepto/zepto"),r=e("wiki-m-common:widget/util/nslog"),u=e("wiki-m-lemma:widget/tools/help/help"),g=e("wiki-m-lemma:widget/tools/dialog/dialog"),p=e("wiki-m-lemma:widget/tools/clickoutside/clickoutside.es"),f=e("wiki-m-common:widget/component/swan/swanUtil"),w=null,v=!1,h=0;t.init=function(e){if(v=!1,e.isLogin||(h=e.is_locked?0:1,v=!0),w=e.lemmaId,!(d("#baike_app_identifier").length>0)){u.storage.set("CATALOG",e.catalog);var t=d("#J-editentrance"),i=d("#J-editentrance-icon");a(function(){t.show(),r.qAll("20005700"),i.addClass("layout-icons_new-pen"),c()},function(){t.show(),r.qAll("20005701"),i.addClass("layout-icons_pen-forbidden")}),s()}},t.insertEditToCatalog=function(){d("#baike_app_identifier").length>0||a(function(){if(d(".J-catalog-lemma-edit").remove(),d(".catalog-item.level1.current")&&d(".catalog-item.level1.current")[0]){for(var e=d(d(".catalog-item.level1.current")[0]),t=u.storage.get("CATALOG"),a=0;a<t.length;a++){var i=t[a];e.text()===i.title&&(i.hasText?(r.qAll("20005706"),e.append('<div data-dl ="'+i.index+'" class="catalog-lemma-edit J-active J-catalog-lemma-edit"><em class="J-edit-icon layout-icons layout-icons_new-pen"></em></div>')):(r.qAll("20005707"),e.append('<div class="catalog-lemma-edit J-catalog-lemma-edit"><em class="J-edit-icon layout-icons layout-icons_pen-forbidden"></em></div>')))}"百科名片"===e.text()&&(r.qAll("20005706"),e.append('<div class="catalog-lemma-edit J-active J-catalog-lemma-edit"><em class="J-edit-icon layout-icons layout-icons_new-pen"></em></div>'))}})}});